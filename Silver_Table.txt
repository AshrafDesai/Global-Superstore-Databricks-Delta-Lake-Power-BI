USE CATALOG superstore_catalog;
USE SCHEMA superstore_db;

CREATE OR REPLACE TABLE silver_superstore
USING DELTA
AS
SELECT
    row_id,
    order_id,
    TO_DATE(order_date, 'MM/dd/yyyy') AS order_date,
    TO_DATE(ship_date, 'MM/dd/yyyy') AS ship_date,
    ship_mode,
    customer_id,
    customer_name,
    segment,
    country,
    city,
    state,
    postal_code,
    region,
    product_id,
    category,
    sub_category,
    product_name,
    TRY_CAST(sales AS DOUBLE) AS sales,
    TRY_CAST(quantity AS INT) AS quantity,
    TRY_CAST(discount AS DOUBLE) AS discount,
    TRY_CAST(profit AS DOUBLE) AS profit,
    TRY_CAST(shipping_cost AS DOUBLE) AS shipping_cost,
    order_priority
FROM bronze_superstore
WHERE order_id IS NOT NULL;

SELECT COUNT(*) 
FROM silver_superstore
WHERE sales IS NULL;

